var BUFFER_LENGTH = 1024 * 8;

var parser = require('./parser');

exports.render = render;

function render(tokens, context, partials, stream, callback) {
  if (!Array.isArray(context)) {
  	console.log("render 0");
    context = [context];
  }
  return _render(tokens, context, partials, stream, callback);
}

function _render(tokens, context, partials, stream, callback) {
	console.log("_render 1");
	var i = 1;
  
	function next() {
		try {
			console.log("_render 2");
			var token = tokens[i++];

			if (!token) {
				return callback ? callback() : true;
			}

			stream.emit('data', token[2]);
			return next();

		} catch (err) {
			console.log("_render err");
			stream.emit('error', err);
			return next();
		}
	}

	return next();
}
